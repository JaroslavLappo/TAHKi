var socket;var mydata={};var timerPlayer;var timerConnection;var gameEnded=false;function ConnectionInit(){socket=io(window.location.origin);$(window).bind("beforeunload",function(){socket.emit("Disco",mydata)});InitErrors();mydata.roomid=$.cookie("roomid");mydata.userid=$.cookie("userid");mydata.userServerId=$.cookie("userServerId");socket.emit("InitGame",mydata);socket.on("BackInitGame",function(b){for(var a=0;a<b.length;a++){if(b[a].team==0){AddPlayer(b[a].userid,"red")}else{if(b[a].team==1){AddPlayer(b[a].userid,"blue")}}players[b[a].userid].SetPosition(b[a].coord)}window.addEventListener("mousemove",MouseMove);window.addEventListener("mouseup",MouseUp);window.addEventListener("mousedown",MouseDown);window.addEventListener("keyup",KeyUp);window.addEventListener("keydown",KeyDown);window.addEventListener("keypress",KeyPress);window.addEventListener("wheel",onWheel);$(window).resize(function(){renderer.setSize(window.innerWidth,window.innerHeight);camera=new THREE.PerspectiveCamera(FOV,window.innerWidth/window.innerHeight,0.1,10000);players[mydata.userid].SetCamera()});players[mydata.userid].SetCamera();renderScene();timerConnection=setInterval(Update,20);timerPlayer=setInterval(UpdateKeyboard,20);$("#fullscreen").fadeOut("slow");$("#score").fadeIn("slow")});socket.on("BackDiscoGame",function(a){RemovePlayer(a)});socket.on("EndRound",function(a){clearInterval(timerConnection);clearInterval(timerPlayer)});socket.on("GG",function(a){gameEnded=true;clearInterval(timerConnection);clearInterval(timerPlayer);$("#splash_text").text("GG. "+a+" wins");$("#fullscreen").fadeIn("fast");$("#btn_index").fadeIn("fast");$("#btn_index").click(function(){window.location.replace(window.location.origin)})});socket.on("BackShoot",function(a){if(gameEnded){return}if(a==mydata.userid){$("#splash_text").text("You died");$("#fullscreen").fadeIn("slow");clearInterval(timerConnection);clearInterval(timerPlayer)}HidePlayer(a)});socket.on("StartNewRound",function(b){if(gameEnded){return}for(var a=0;a<b.users.length;a++){ShowPlayer(b.users[a].userid);players[b.users[a].userid].SetPosition(b.users[a].coord);players[b.users[a].userid].SetRotate(b.users[a].rotation)}timerConnection=setInterval(Update,20);timerPlayer=setInterval(UpdateKeyboard,20);players[mydata.userid].SetCamera();if(gameEnded){return}$("#fullscreen").fadeOut("slow");$("#score_red").text(b.recount);$("#score_blue").text(b.blcount)});socket.on("BackGame",function(b){for(var a=0;a<b.length;a++){if(b[a].userid!=mydata.userid){players[b[a].userid].SetPosition(b[a].coord);players[b[a].userid].SetRotate(b[a].rotation)}}})}function Response(){mydata.coord=players[mydata.userid].GetPosition();mydata.rotation=players[mydata.userid].Model.rotation.y;socket.emit("Game",mydata)};