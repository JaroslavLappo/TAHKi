var socket;var mydata={};var timerPlayer;var timerConnection;var gameEnded=false;function ConnectionInit(){socket=io(window.location.origin);$(window).bind("beforeunload",function(){socket.emit("Disco",mydata)});InitErrors();mydata.roomid=$.cookie("roomid");mydata.userid=$.cookie("userid");mydata.userServerId=$.cookie("userServerId");socket.emit("InitGame",mydata);socket.on("BackInitGame",function(d){var a=1;var b=1;for(var c=0;c<d.length;c++){if(d[c].team==0){$("#red_player_"+a+"_n").text(d[c].userid);$("#red_player_"+a+"_k").text(d[c].kills);$("#red_player_"+a+"_d").text(d[c].deth);a++;AddPlayer(d[c].userid,"red")}else{if(d[c].team==1){AddPlayer(d[c].userid,"blue");$("#blue_player_"+b+"_n").text(d[c].userid);$("#blue_player_"+b+"_k").text(d[c].kills);$("#blue_player_"+b+"_d").text(d[c].deth);b++}}players[d[c].userid].SetPosition(d[c].coord)}window.addEventListener("mousemove",MouseMove);window.addEventListener("mouseup",MouseUp);window.addEventListener("mousedown",MouseDown);window.addEventListener("keyup",KeyUp);window.addEventListener("keydown",KeyDown);window.addEventListener("keypress",KeyPress);window.addEventListener("keydown",function(f){if(f.keyCode==KEY_CODE.DOTA){$("#stats").show()}});window.addEventListener("keyup",function(f){if(f.keyCode==KEY_CODE.DOTA){$("#stats").hide()}});window.addEventListener("keypress",KeyPress);window.addEventListener("wheel",onWheel);$(window).resize(function(){renderer.setSize(window.innerWidth,window.innerHeight);camera=new THREE.PerspectiveCamera(FOV,window.innerWidth/window.innerHeight,0.1,10000);players[mydata.userid].SetCamera()});players[mydata.userid].SetCamera();renderScene();timerConnection=setInterval(Update,20);timerPlayer=setInterval(UpdateKeyboard,20);$("#fullscreen").fadeOut("slow");$("#score").fadeIn("slow")});socket.on("BackDiscoGame",function(a){RemovePlayer(a)});socket.on("EndRound",function(a){});socket.on("GG",function(a){gameEnded=true;clearInterval(timerConnection);clearInterval(timerPlayer);$("#splash_text").text("GG. "+a+" wins");$("#fullscreen").fadeIn("fast");$("#btn_index").fadeIn("fast");$("#btn_index").click(function(){window.location.replace(window.location.origin)})});socket.on("BackShoot",function(b){if(gameEnded){return}players[b.killer].Shoot();if(b.killed==-1){return}var a=players[b.killer].team;var c=players[b.killed].team;$("#chat").append("<li class='chat_unit'><span class='team_"+a+"'>"+b.killer+"</span>&nbsp;&nbsp;̵͇̿̿/̿'̿ ̿ &nbsp;&nbsp;<span class='team_"+c+"'>"+b.killed+"</span></li>");if(b.killed==mydata.userid){$("#splash_text").text("You died");$("#fullscreen").fadeIn("slow")}HidePlayer(b.killed)});socket.on("StartNewRound",function(b){if(gameEnded){return}$("#chat").empty();for(var a=0;a<b.users.length;a++){ShowPlayer(b.users[a].userid);players[b.users[a].userid].SetPosition(b.users[a].coord);players[b.users[a].userid].SetRotate(b.users[a].rotation)}players[mydata.userid].SetCamera();if(gameEnded){return}$("#fullscreen").fadeOut("slow");$("#score_red").text(b.recount);$("#score_blue").text(b.blcount)});socket.on("StatsUpdate",function(d){d.sort(function(f,e){return f.kills-e.kills});for(var c=0;c<5;c++){$("#red_player_"+c+"_n").text("-");$("#red_player_"+c+"_k").text(0);$("#red_player_"+c+"_d").text(0);$("#blue_player_"+c+"_n").text("-");$("#blue_player_"+c+"_k").text(0);$("#blue_player_"+c+"_d").text(0)}var a=1;var b=1;for(var c=0;c<d.length;c++){if(d[c].team==0){$("#red_player_"+a+"_n").text(d[c].userid);$("#red_player_"+a+"_k").text(d[c].kills);$("#red_player_"+a+"_d").text(d[c].deth);a++}else{$("#blue_player_"+b+"_n").text(d[c].userid);$("#blue_player_"+b+"_k").text(d[c].kills);$("#blue_player_"+b+"_d").text(d[c].deth);b++}}});socket.on("BackGame",function(b){for(var a=0;a<b.length;a++){if(b[a].userid!=mydata.userid){players[b[a].userid].SetPosition(b[a].coord);players[b[a].userid].SetRotate(b[a].rotation)}}})}function Response(){UpdatePatricles();mydata.coord=players[mydata.userid].GetPosition();mydata.rotation=players[mydata.userid].Model.rotation.y;socket.emit("Game",mydata)};